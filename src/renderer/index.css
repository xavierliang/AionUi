.loading {
  animation: loading 1s linear infinite;
}

.bg-animate {
  animation: bg-animate 1s alternate infinite;
}

@keyframes bg-animate {
  0% {
    background-color: #f2f3f5;
  }
  100% {
    background-color: #e5e6eb;
  }
}

@keyframes loading {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

.collapsed {
  .collapsed-hidden {
    display: none;
  }
  .\!collapsed-hidden {
    display: none !important;
  }
}

/* CSS Dark Mode using filter invert */

/* Apply dark mode to the entire page */
html {
  /* Use a smooth transition for better UX */
  transition:
    filter 0.3s ease,
    background-color 0.3s ease;
}
html[data-theme='dark'] {
  /* Set a light background that will become dark when inverted */
  background-color: #f0f0f0;

  /* Invert colors and adjust hue/contrast for better readability */
  filter: invert(1) hue-rotate(180deg) contrast(0.9) brightness(1.1);
}

[data-theme='dark'] body {
  /* Ensure body doesn't override the background */
  background-color: transparent;
}

/* Revert inversion for media elements to show them normally */
html[data-theme="dark"] img, 
html[data-theme="dark"] video, 
html[data-theme="dark"] iframe, 
html[data-theme="dark"] embed, 
html[data-theme="dark"] object,
html[data-theme="dark"] canvas,
/* Also handle background images */
html[data-theme="dark"] [style*="background-image"],
/* Common image containers */
html[data-theme="dark"] .image,
html[data-theme="dark"] .logo,
html[data-theme="dark"] .avatar,
html[data-theme="dark"] .thumbnail,
html[data-theme="dark"] .photo,
/* AionUi logo container */
html[data-theme="dark"] .layout-sider-header > div:first-child {
  /* Double inversion cancels out, showing original colors */
  filter: invert(1) hue-rotate(180deg);

  /* Smooth transition for better UX */
  transition: filter 0.3s ease;
}

/* Handle elements that might contain mixed content */
[data-theme='dark'] .content-area img,
[data-theme='dark'] .post-content img,
[data-theme='dark'] article img {
  filter: invert(1) hue-rotate(180deg);
}

/* Fix for elements that should remain dark */
[data-theme='dark'] input[type='color'],
[data-theme='dark'] progress,
[data-theme='dark'] meter {
  filter: invert(1) hue-rotate(180deg);
}

/* Improve contrast for text elements */
[data-theme='dark'] h1,
[data-theme='dark'] h2,
[data-theme='dark'] h3,
[data-theme='dark'] h4,
[data-theme='dark'] h5,
[data-theme='dark'] h6,
[data-theme='dark'] p,
[data-theme='dark'] span,
[data-theme='dark'] a,
[data-theme='dark'] li,
[data-theme='dark'] td,
[data-theme='dark'] th,
[data-theme='dark'] .text-content {
  text-shadow: none;
}

/* Handle code blocks and pre-formatted text */
[data-theme='dark'] code,
[data-theme='dark'] pre,
[data-theme='dark'] .code-block,
[data-theme='dark'] .syntax-highlight {
  filter: invert(1) hue-rotate(180deg) contrast(1.2);
  border-radius: 4px;
}

/* Fix for form elements that might look weird */
[data-theme='dark'] input,
[data-theme='dark'] textarea,
[data-theme='dark'] select,
[data-theme='dark'] button {
  transition: filter 0.3s ease;
}

/* Add a toggle class for easier JavaScript control */
[data-theme='dark'] .dark-mode-disabled {
  filter: none !important;
}

[data-theme='dark'] .dark-mode-disabled img,
[data-theme='dark'] .dark-mode-disabled video,
[data-theme='dark'] .dark-mode-disabled iframe,
[data-theme='dark'] .dark-mode-disabled embed,
[data-theme='dark'] .dark-mode-disabled object,
[data-theme='dark'] .dark-mode-disabled svg,
[data-theme='dark'] .dark-mode-disabled canvas {
  filter: none !important;
}

/* Handle specific UI elements that might need adjustment */
[data-theme='dark'] .button,
[data-theme='dark'] .btn,
[data-theme='dark'] .card,
[data-theme='dark'] .modal,
[data-theme='dark'] .dropdown {
  border: 1px solid rgba(255, 255, 255, 0.1);
}

/* Design light scrollbar that becomes dark when inverted */
[data-theme='dark'] ::-webkit-scrollbar {
  width: 12px;
}

[data-theme='dark'] ::-webkit-scrollbar-track {
  background: #e5e5e5;
}

[data-theme='dark'] ::-webkit-scrollbar-thumb {
  background: #cccccc;
  border-radius: 6px;
}

[data-theme='dark'] ::-webkit-scrollbar-thumb:hover {
  background: #b8b8b8;
}

/* 移动端自适应字体大小 */
@media (max-width: 768px) {
  /* 基础字体大小调整 */
  html {
    font-size: 16px; /* iPhone基础字体大小调整为16px，解决字体过小问题 */
  }

  /* 针对iPhone的专门优化 */
  @supports (-webkit-touch-callout: none) {
    html {
      font-size: 18px; /* iPhone Safari专用更大的字体 */
    }
  }

  /* 针对小屏幕手机的进一步优化 */
  @media (max-width: 480px) {
    html {
      font-size: 15px; /* 小屏幕手机字体稍大 */
    }

    /* iPhone小屏幕优化 */
    @supports (-webkit-touch-callout: none) {
      html {
        font-size: 17px; /* iPhone小屏幕使用更大字体 */
      }
    }
  }

  /* iPhone SE等小屏设备 */
  @media (max-width: 375px) {
    @supports (-webkit-touch-callout: none) {
      html {
        font-size: 16px; /* iPhone SE等最小屏幕设备 */
      }
    }
  }

  /* Fix horizontal scroll issues on mobile */
  @media (max-width: 768px) {
    /* Prevent horizontal overflow */
    body {
      overflow-x: hidden;
      width: 100vw;
      max-width: 100vw;
    }

    /* Ensure all containers don't exceed viewport width */
    .container,
    .main-container,
    .chat-container {
      max-width: 100vw;
      overflow-x: hidden;
    }

    /* Fix message item width constraints */
    .message-item {
      min-width: auto !important;
      max-width: 100% !important;
      width: 100% !important;
      padding-left: 8px !important;
      padding-right: 8px !important;
    }

    /* Fix table overflow in markdown */
    .markdown-shadow-body table {
      max-width: 100% !important;
      display: block;
      overflow-x: auto;
    }

    /* Ensure images don't cause overflow */
    img,
    video,
    svg {
      max-width: 100% !important;
      height: auto !important;
    }

    /* Fix any calc() width issues */
    * {
      box-sizing: border-box;
    }

    /* Strict overflow control for all elements */
    html,
    body,
    #root,
    .layout,
    .arco-layout {
      overflow-x: hidden !important;
      max-width: 100vw !important;
    }

    /* Fix flex containers that might overflow */
    .flex,
    .flex-1,
    .flex-auto,
    .flex-grow {
      min-width: 0 !important;
      max-width: 100% !important;
    }

    /* Fix pre/code blocks */
    pre,
    code {
      max-width: 100% !important;
      overflow-x: auto !important;
      word-break: break-word !important;
      white-space: pre-wrap !important;
    }

    /* Fix tables and diff viewers */
    table,
    .d2h-wrapper,
    .diff2html {
      max-width: 100% !important;
      overflow-x: auto !important;
    }

    /* Remove any potential margin/padding that could cause overflow */
    .mx-auto,
    .px-8px,
    .m-t-10px {
      margin-left: auto !important;
      margin-right: auto !important;
      padding-left: 4px !important;
      padding-right: 4px !important;
    }

    /* 移动端侧边栏优化 */
    .layout-sider {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      height: 100vh !important;
      z-index: 100 !important;
      transition: transform 0.3s ease !important;
    }

    .layout-sider.collapsed {
      transform: translateX(-100%) !important;
    }

    /* 移动端内容区域调整 */
    .layout-content {
      margin-left: 0 !important;
      transition: margin-left 0.3s ease !important;
    }

    /* 移动端toggle按钮样式 - 简洁风格 */
    .mobile-toggle-btn {
      background: transparent !important;
      border: none !important;
      box-shadow: none !important;
      padding: 0 !important;
      margin: 0 !important;
    }

    .mobile-toggle-btn:hover {
      background: rgba(0, 0, 0, 0.05) !important;
      transform: none !important;
      box-shadow: none !important;
    }

    /* 为移动端header添加左内边距，给toggle按钮让位置 - 调整为64px以适应更大的按钮 */
    @media (max-width: 768px) {
      #root > section > main > section > main > header {
        padding-left: 64px !important; /* 给更大的toggle按钮留空间 */
      }
    }

    /* 确保移动端侧边栏完全隐藏 */
    .arco-layout-sider-collapsed {
      width: 0 !important;
      min-width: 0 !important;
      max-width: 0 !important;
      overflow: hidden !important;
    }
  }

  /* 针对小于415px屏幕的优化 */
  @media (max-width: 415px) {
    /* 修复GeminiChat组件的内边距导致的滚动条问题 */
    #root > section > main > section > main > main > div {
      padding-left: 8px !important;
      padding-right: 8px !important;
      overflow-x: hidden !important;
      width: 100% !important;
      max-width: 100vw !important;
    }

    /* 修复FlexFullContainer的flex-1 relative div */
    #root > section > main > section > main > main > div > div.flex-1.relative {
      min-width: 0 !important;
      max-width: 100% !important;
      overflow: hidden !important;
    }

    /* 修复MessageList的滚动容器 */
    #root > section > main > section > main > main > div > div.flex-1.relative > div {
      overflow-y: auto !important;
      overflow-x: hidden !important;
      max-width: 100% !important;
      min-width: 0 !important;
      padding-bottom: 0 !important;
    }

    /* 确保所有子元素都不会导致溢出 */
    #root > section > main > section > main > main > div > div.flex-1.relative > div * {
      max-width: 100% !important;
      word-break: break-word !important;
    }

    /* 修复消息项的最大宽度 */
    .message-item {
      max-width: 100% !important;
      min-width: auto !important;
      width: 100% !important;
    }

    /* 确保pre和code块不会溢出 */
    pre,
    code {
      max-width: 100% !important;
      overflow-x: auto !important;
      word-break: break-word !important;
      white-space: pre-wrap !important;
    }

    /* 修复表格和diff查看器 */
    table,
    .d2h-wrapper,
    .diff2html {
      max-width: 100% !important;
      display: block !important;
      overflow-x: auto !important;
    }

    /* 确保图片不会溢出 */
    img,
    video,
    svg {
      max-width: 100% !important;
      height: auto !important;
    }

    /* 强制所有flex容器在小屏幕上正确换行 */
    .flex,
    .flex-1,
    .flex-auto,
    .flex-grow,
    .flex-col {
      min-width: 0 !important;
      max-width: 100% !important;
    }
  }

  /* 确保某些特定元素在移动端有更好的可读性 */
  .text-14px {
    font-size: 0.875rem !important;
  }

  .text-16px {
    font-size: 1rem !important;
  }

  .text-20px {
    font-size: 1.25rem !important;
  }

  /* 聊天消息字体大小优化 */
  .text-15px {
    font-size: 0.9375rem !important;
  }

  /* iPhone聊天消息专门优化 */
  @supports (-webkit-touch-callout: none) {
    .text-15px {
      font-size: 1.1rem !important;
      line-height: 1.6 !important;
    }
  }

  /* 标题字体大小调整 */
  .text-2xl {
    font-size: 1.5rem !important;
  }

  .text-xl {
    font-size: 1.25rem !important;
  }

  /* iPhone标题优化 */
  @supports (-webkit-touch-callout: none) {
    .text-2xl {
      font-size: 1.8rem !important;
      line-height: 1.4 !important;
    }

    .text-xl {
      font-size: 1.5rem !important;
      line-height: 1.4 !important;
    }
  }

  /* 按钮和交互元素字体大小 */
  .arco-btn,
  button {
    font-size: 0.875rem !important;
  }

  /* iPhone按钮优化 */
  @supports (-webkit-touch-callout: none) {
    .arco-btn,
    button {
      font-size: 1rem !important;
      padding: 12px 16px !important; /* 更大的点击区域 */
      min-height: 44px !important; /* iPhone推荐的最小点击高度 */
    }
  }

  /* 输入框字体大小 */
  .arco-input,
  input,
  textarea {
    font-size: 0.875rem !important;
  }

  /* iPhone输入框优化 */
  @supports (-webkit-touch-callout: none) {
    .arco-input,
    input,
    textarea {
      font-size: 1rem !important;
      padding: 12px !important;
      min-height: 44px !important;
    }
  }

  /* 侧边栏字体大小优化 */
  .layout-sider {
    font-size: 0.875rem;
  }

  /* 聊天界面右侧边栏字体优化 */
  .arco-layout-sider {
    font-size: 0.875rem;
  }

  /* iPhone全局文本优化 */
  @supports (-webkit-touch-callout: none) {
    body {
      -webkit-text-size-adjust: 100%; /* 防止iPhone自动调整字体大小 */
      text-size-adjust: 100%;
    }

    /* 确保所有文本在iPhone上都有合适的行高 */
    p,
    div,
    span,
    li,
    td,
    th {
      line-height: 1.6 !important;
    }

    /* 聊天消息特殊优化 */
    .message-content,
    .chat-message,
    .conversation-message {
      font-size: 1.1rem !important;
      line-height: 1.7 !important;
      letter-spacing: 0.3px !important; /* 增加字母间距提高可读性 */
    }
  }
}

/* SendBox icon buttons: fix size and icon display on iPhone */
.sendbox-icon-btn {
  height: 32px !important;
  width: 32px !important;
  min-height: 32px !important;
  padding: 0 !important;
  border-radius: 9999px !important;
  display: inline-flex !important;
  align-items: center;
  justify-content: center;
  line-height: 1 !important;
}

.sendbox-icon-btn svg {
  width: 18px !important;
  height: 18px !important;
  flex: 0 0 auto !important;
}

/* iPhone Safari specific fix */
@supports (-webkit-touch-callout: none) {
  .sendbox-icon-btn {
    height: 36px !important;
    width: 36px !important;
    min-height: 36px !important;
  }
  .sendbox-icon-btn svg {
    width: 20px !important;
    height: 20px !important;
  }
}

/* SendBox icon buttons alignment improvements */
.sendbox-icon-btn {
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  gap: 0 !important;
  line-height: 1 !important;
}
.sendbox-icon-btn > span,
.sendbox-icon-btn .arco-icon,
.sendbox-icon-btn .arco-btn-icon {
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  line-height: 1 !important;
}
.sendbox-icon-btn svg {
  display: block !important;
}

/* Model round button to match icon buttons height and baseline */
.sendbox-model-btn {
  height: 36px !important;
  min-height: 36px !important;
  padding: 0 12px !important;
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  line-height: 1 !important;
}
.sendbox-model-btn > span {
  /* Arco wraps text in span */
  line-height: 1 !important;
  display: inline-flex !important;
  align-items: center !important;
}

/* Prevent global span line-height override from affecting button contents on iPhone */
@supports (-webkit-touch-callout: none) {
  .sendbox-icon-btn > span,
  .sendbox-icon-btn .arco-icon,
  .sendbox-icon-btn .arco-btn-icon,
  .sendbox-model-btn > span {
    line-height: 1 !important;
  }
}

/* Tools wrapper: ensure inner buttons align center on same baseline */
.sendbox-tools {
  display: inline-flex !important;
  align-items: center !important;
  gap: 8px !important;
  line-height: 1 !important;
}

/* Plus icon slight vertical compensation to avoid visual top bias */
.sendbox-icon-plus .arco-btn-icon svg {
  transform: translateY(1px);
}

@supports (-webkit-touch-callout: none) {
  .sendbox-tools {
    line-height: 1 !important;
  }
}

/* iOS Safari: relax global overflow/height to avoid keyboard flicker and allow paste menu */
@supports (-webkit-touch-callout: none) {
  html,
  body {
    overflow-x: hidden !important;
    overflow-y: auto !important;
    height: auto !important;
    min-height: 100% !important;
    -webkit-overflow-scrolling: touch;
  }

  #root {
    height: auto !important;
    min-height: 100dvh !important;
  }

  /* Ensure main containers can expand with dynamic viewport */
  .layout,
  .arco-layout,
  .layout-content {
    min-height: 100dvh !important;
  }
}
